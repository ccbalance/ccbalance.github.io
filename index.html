<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#00d4ff">
    <title>CCBalance - 化学平衡策略游戏</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="fontawesome/css/all.min.css">
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/splash.css">
    <link rel="stylesheet" href="src/styles/particles.css">
    <link rel="stylesheet" href="src/styles/ui-components.css">
    <link rel="stylesheet" href="src/styles/animations.css">
    <link rel="stylesheet" href="src/styles/game-board.css">
    <link rel="stylesheet" href="src/styles/terminal.css">
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splash-screen" style="opacity: 1;">
        <div class="splash-center">
            <div class="splash-title">CC Chemistry Game</div>
        </div>
        <div class="splash-footer">
            <div class="splash-license">Published with CC0 Public Domain License</div>
        </div>
    </div>

    <!-- 自定义标题栏 -->
    <div class="title-bar">
        <div class="title-bar-drag">
            <span class="title-logo"><i class="fas fa-atom"></i></span>
            <span class="title-text">CCBalance</span>
        </div>
        <div class="title-bar-controls">
            <button class="title-btn" id="btn-minimize"><i class="fas fa-minus"></i></button>
            <button class="title-btn" id="btn-maximize"><i class="fas fa-square"></i></button>
            <button class="title-btn title-btn-close" id="btn-close"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <!-- 背景粒子画布 -->
    <canvas id="bg-particles"></canvas>
    
    <!-- 游戏粒子画布 -->
    <canvas id="game-particles" class="game-particles-canvas"></canvas>

    <!-- 主容器 -->
    <div class="main-container">
        <!-- 主菜单 -->
        <div id="main-menu" class="screen active">
            <div class="menu-content">
                <h1 class="game-title">
                    <span class="title-glow">CC</span><span class="title-balance">Balance</span>
                </h1>
                <p class="subtitle">化学平衡策略对战</p>
                
                <div class="menu-buttons">
                    <button class="menu-btn primary" id="btn-start-game">
                        <i class="fas fa-play"></i>
                        <span>开始游戏</span>
                    </button>
                    <button class="menu-btn" id="btn-level-select">
                        <i class="fas fa-flask"></i>
                        <span>关卡选择</span>
                    </button>
                    <button class="menu-btn" id="btn-workshop">
                        <i class="fas fa-wrench"></i>
                        <span>创意工坊</span>
                    </button>
                    <button class="menu-btn" id="btn-collection">
                        <i class="fas fa-book"></i>
                        <span>方程画廊</span>
                    </button>
                    <button class="menu-btn" id="btn-settings">
                        <i class="fas fa-cog"></i>
                        <span>设置</span>
                    </button>
                </div>

                <div class="menu-info">
                    <div class="info-item">
                        <i class="fas fa-trophy"></i>
                        <span id="total-progress">0/100</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-star"></i>
                        <span id="total-stars">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 关卡选择界面 -->
        <div id="level-select" class="screen">
            <div class="screen-header">
                <button class="back-btn" id="btn-back-menu"><i class="fas fa-arrow-left"></i></button>
                <h2>关卡选择</h2>
            </div>
            
            <div class="category-tabs">
                <button class="category-tab active" data-category="ionic">
                    <i class="fas fa-bolt"></i>
                    <span>离子反应</span>
                </button>
                <button class="category-tab" data-category="redox">
                    <i class="fas fa-exchange-alt"></i>
                    <span>氧化还原</span>
                </button>
                <button class="category-tab" data-category="dissolution">
                    <i class="fas fa-tint"></i>
                    <span>溶解平衡</span>
                </button>
                <button class="category-tab" data-category="ionization">
                    <i class="fas fa-water"></i>
                    <span>电离水解</span>
                </button>
                <button class="category-tab" data-category="complex">
                    <i class="fas fa-puzzle-piece"></i>
                    <span>综合反应</span>
                </button>
                <button class="category-tab" data-category="electrochemistry">
                    <i class="fas fa-battery-three-quarters"></i>
                    <span>电化学</span>
                </button>
                <button class="category-tab" data-category="organic">
                    <i class="fas fa-flask"></i>
                    <span>有机反应</span>
                </button>
            </div>

            <div class="levels-grid" id="levels-container"></div>
            
            <div class="difficulty-selector">
                <span>AI难度:</span>
                <button class="diff-btn active" data-diff="1">初级</button>
                <button class="diff-btn" data-diff="2">中级</button>
                <button class="diff-btn" data-diff="3">高级</button>
                <button class="diff-btn" data-diff="4">C·C</button>
            </div>
        </div>

        <!-- 游戏界面 -->
        <div id="game-screen" class="screen">
            <!-- 游戏顶部信息栏 -->
            <div class="game-header">
                <div class="player-info player-side">
                    <div class="player-avatar"><i class="fas fa-user"></i></div>
                    <div class="player-details">
                        <span class="player-name">玩家</span>
                        <div class="player-goal">
                            <span>目标:</span>
                            <span id="player-goal-text">增大正向反应</span>
                        </div>
                    </div>
                </div>

                <div class="round-info">
                    <div class="round-number">
                        <span>回合</span>
                        <span id="current-round">1</span>
                        <span>/</span>
                        <span id="total-rounds">10</span>
                    </div>
                    <div class="timer" id="turn-timer">
                        <i class="fas fa-clock"></i>
                        <span>30</span>
                    </div>
                </div>

                <div class="ai-info ai-side">
                    <div class="player-details">
                        <span class="player-name">AI</span>
                        <div class="player-goal">
                            <span>目标:</span>
                            <span id="ai-goal-text">增大逆向反应</span>
                        </div>
                    </div>
                    <div class="player-avatar ai"><i class="fas fa-robot"></i></div>
                </div>
            </div>

            <!-- 化学方程式显示 -->
            <div class="equation-display">
                <div class="equation-container" id="equation-container">
                    <div class="reactants" id="reactants"></div>
                    <div class="equilibrium-arrow">
                        <i class="fas fa-arrows-alt-h"></i>
                    </div>
                    <div class="products" id="products"></div>
                </div>
                <div class="reaction-info">
                    <span id="reaction-type-badge" class="reaction-badge">可逆反应</span>
                    <span id="enthalpy-badge" class="enthalpy-badge">
                        <i class="fas fa-fire"></i>
                        <span>吸热反应</span>
                    </span>
                </div>
            </div>

            <!-- 平衡可视化区域 -->
            <div class="balance-visualization">
                <canvas id="particle-canvas"></canvas>
                <div class="balance-indicator">
                    <div class="balance-bar">
                        <div class="balance-pointer" id="balance-pointer"></div>
                        <div class="balance-fill-left" id="balance-left"></div>
                        <div class="balance-fill-right" id="balance-right"></div>
                    </div>
                    <div class="balance-labels">
                        <span class="label-left">逆向</span>
                        <span class="label-center">平衡</span>
                        <span class="label-right">正向</span>
                    </div>
                </div>
            </div>

            <!-- 参数控制面板 -->
            <div class="control-panel">
                <div class="param-controls">
                    <!-- 浓度投料 -->
                    <div class="param-group" data-param="concentration">
                        <div class="param-header">
                            <i class="fas fa-vial"></i>
                            <span>投料</span>
                        </div>
                        <div class="button-grid" id="concentration-buttons"></div>
                    </div>

                    <!-- 温度控制 -->
                    <div class="param-group" data-param="temperature">
                        <div class="param-header">
                            <i class="fas fa-thermometer-half"></i>
                            <span>温度 <span id="temp-value">298</span> K</span>
                        </div>
                        <div class="button-row">
                            <button class="param-btn" id="btn-heat" data-action="heat">
                                <i class="fas fa-fire"></i>
                                <span>升温 +20K</span>
                                <div class="btn-cooldown" id="cd-heat"></div>
                            </button>
                            <button class="param-btn" id="btn-cool" data-action="cool">
                                <i class="fas fa-snowflake"></i>
                                <span>降温 -20K</span>
                                <div class="btn-cooldown" id="cd-cool"></div>
                            </button>
                        </div>
                    </div>

                    <!-- 压强控制 -->
                    <div class="param-group" data-param="pressure">
                        <div class="param-header">
                            <i class="fas fa-compress-arrows-alt"></i>
                            <span>压强 <span id="pressure-value">101</span> kPa</span>
                        </div>
                        <div class="button-row">
                            <button class="param-btn" id="btn-pressurize" data-action="pressurize">
                                <i class="fas fa-compress"></i>
                                <span>加压 +50kPa</span>
                                <div class="btn-cooldown" id="cd-pressurize"></div>
                            </button>
                            <button class="param-btn" id="btn-depressurize" data-action="depressurize">
                                <i class="fas fa-expand"></i>
                                <span>减压 -50kPa</span>
                                <div class="btn-cooldown" id="cd-depressurize"></div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 特殊能力卡牌 -->
                <div class="ability-cards">
                    <div class="ability-card" data-ability="catalyst" data-key="1">
                        <div class="card-key">1</div>
                        <i class="fas fa-bolt"></i>
                        <span>催化剂</span>
                        <div class="card-cooldown"></div>
                    </div>
                    <div class="ability-card" data-ability="buffer" data-key="2">
                        <div class="card-key">2</div>
                        <i class="fas fa-shield-alt"></i>
                        <span>缓冲液</span>
                        <div class="card-cooldown"></div>
                    </div>
                    <div class="ability-card" data-ability="heatexchange" data-key="3">
                        <div class="card-key">3</div>
                        <i class="fas fa-fire-alt"></i>
                        <span>热交换</span>
                        <div class="card-cooldown"></div>
                    </div>
                    <div class="ability-card" data-ability="quantum" data-key="4">
                        <div class="card-key">4</div>
                        <i class="fas fa-atom"></i>
                        <span>量子跃迁</span>
                        <div class="card-cooldown"></div>
                    </div>
                </div>

            </div>

            <!-- 侧边信息面板 -->
            <div class="info-panel" id="info-panel">
                <div class="panel-header">
                    <i class="fas fa-info-circle"></i>
                    <span>反应信息</span>
                    <button class="panel-toggle" id="toggle-info"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="panel-content">
                    <div class="info-section">
                        <h4>平衡常数</h4>
                        <div class="info-value" id="equilibrium-constant">K = 1.0</div>
                    </div>
                    <div class="info-section">
                        <h4>当前浓度</h4>
                        <div class="concentration-list" id="concentration-list"></div>
                    </div>
                    <div class="info-section">
                        <h4>反应商</h4>
                        <div class="info-value" id="reaction-quotient">Q = 1.0</div>
                    </div>
                    <div class="info-section chart-section">
                        <h4>浓度曲线</h4>
                        <canvas id="chart-canvas"></canvas>
                    </div>
                </div>
            </div>

            <!-- 暂停菜单 -->
            <div class="pause-menu" id="pause-menu">
                <div class="pause-content glass-panel">
                    <h2>游戏暂停</h2>
                    <button class="menu-btn" id="btn-resume">
                        <i class="fas fa-play"></i>
                        <span>继续游戏</span>
                    </button>
                    <button class="menu-btn" id="btn-restart">
                        <i class="fas fa-redo"></i>
                        <span>重新开始</span>
                    </button>
                    <button class="menu-btn" id="btn-quit">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>返回菜单</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 游戏结果界面 -->
        <div id="result-screen" class="screen">
            <div class="result-content">
                <div class="result-icon" id="result-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <h2 class="result-title" id="result-title">胜利</h2>
                <p class="result-subtitle" id="result-subtitle">成功控制化学平衡</p>
                
                <div class="result-stats">
                    <div class="stat-item">
                        <i class="fas fa-bullseye"></i>
                        <span>目标达成度</span>
                        <span class="stat-value" id="stat-achievement">100%</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <span>使用回合</span>
                        <span class="stat-value" id="stat-rounds">5</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-star"></i>
                        <span>获得星级</span>
                        <span class="stat-value" id="stat-stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </span>
                    </div>
                </div>

                <div class="result-equation glass-panel">
                    <h4>掌握方程式</h4>
                    <div id="mastered-equation"></div>
                </div>

                <div class="result-buttons">
                    <button class="menu-btn" id="btn-next-level">
                        <i class="fas fa-arrow-right"></i>
                        <span>下一关</span>
                    </button>
                    <button class="menu-btn secondary" id="btn-replay">
                        <i class="fas fa-redo"></i>
                        <span>重玩</span>
                    </button>
                    <button class="menu-btn secondary" id="btn-back-levels">
                        <i class="fas fa-list"></i>
                        <span>关卡列表</span>
                    </button>
                </div>
            </div>
            <canvas id="result-particles"></canvas>
        </div>

        <!-- 图鉴界面 -->
        <div id="collection-screen" class="screen">
            <div class="screen-header">
                <button class="back-btn" id="btn-back-menu-2"><i class="fas fa-arrow-left"></i></button>
                <h2>方程画廊</h2>
            </div>
            <div class="collection-filters">
                <button class="filter-btn active" data-filter="all">全部</button>
                <button class="filter-btn" data-filter="unlocked">已解锁</button>
                <button class="filter-btn" data-filter="locked">未解锁</button>
            </div>
            <div class="collection-grid" id="collection-grid"></div>
        </div>

        <!-- 创意工坊界面 -->
        <div id="workshop-screen" class="screen">
            <div class="screen-header">
                <button class="back-btn" id="btn-back-menu-workshop"><i class="fas fa-arrow-left"></i></button>
                <h2>创意工坊</h2>
            </div>

            <div class="workshop-toolbar">
                <button class="toolbar-btn primary" id="btn-import-level">
                    <i class="fas fa-file-import"></i>
                    <span>导入关卡</span>
                </button>
                <button class="toolbar-btn" id="btn-download-level">
                    <i class="fas fa-download"></i>
                    <span>从网络下载</span>
                </button>
                <button class="toolbar-btn" id="btn-create-template">
                    <i class="fas fa-plus"></i>
                    <span>创建模板</span>
                </button>
                <button class="toolbar-btn danger" id="btn-clear-workshop">
                    <i class="fas fa-trash"></i>
                    <span>清空所有</span>
                </button>
            </div>

            <div class="workshop-info">
                <i class="fas fa-info-circle"></i>
                <span>创意工坊支持自定义关卡,使用 .ccb 文件格式。详见 <a href="#" id="link-ccb-format">CCB 格式规范</a></span>
            </div>

            <div class="workshop-levels" id="workshop-levels">
                <div class="empty-hint">
                    <i class="fas fa-box-open"></i>
                    <p>还没有导入任何关卡</p>
                    <p>点击上方按钮导入或创建关卡</p>
                </div>
            </div>
        </div>

        <!-- 设置界面 -->
        <div id="settings-screen" class="screen">
            <div class="screen-header">
                <button class="back-btn" id="btn-back-menu-3"><i class="fas fa-arrow-left"></i></button>
                <h2>设置</h2>
            </div>
            <div class="settings-content">
                <div class="setting-group">
                    <h3><i class="fas fa-volume-up"></i> 音频</h3>
                    <div class="setting-item">
                        <span>音效音量</span>
                        <input type="range" class="setting-slider" id="sfx-volume" min="0" max="100" value="80">
                    </div>
                    <div class="setting-item">
                        <span>背景音乐</span>
                        <input type="range" class="setting-slider" id="bgm-volume" min="0" max="100" value="60">
                    </div>
                </div>
                <div class="setting-group">
                    <h3><i class="fas fa-eye"></i> 视觉</h3>
                    <div class="setting-item">
                        <span>粒子数量</span>
                        <select class="setting-select" id="particle-count">
                            <option value="low">低 (50)</option>
                            <option value="medium" selected>中 (200)</option>
                            <option value="high">高 (500)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>动画效果</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enable-animations" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-group">
                    <h3><i class="fas fa-gamepad"></i> 游戏</h3>
                    <div class="setting-item">
                        <span>回合时间</span>
                        <select class="setting-select" id="turn-time">
                            <option value="15">15秒</option>
                            <option value="30" selected>30秒</option>
                            <option value="60">60秒</option>
                            <option value="0">无限制</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>显示提示</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="show-hints" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>关卡回合数</span>
                        <select class="setting-select" id="rounds-per-level">
                            <option value="1">1 回合</option>
                            <option value="3">3 回合</option>
                            <option value="5">5 回合</option>
                            <option value="7">7 回合</option>
                            <option value="10" selected>10 回合</option>
                        </select>
                    </div>
                </div>
                <div class="setting-group">
                    <h3><i class="fas fa-palette"></i> 粒子效果</h3>
                    <div class="setting-item">
                        <span>粒子颜色</span>
                        <input type="color" class="setting-color" id="particle-color" value="#00d4ff">
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3><i class="fas fa-server"></i> PWA 服务器</h3>
                    <div class="setting-item">
                        <span>服务器状态</span>
                        <div class="server-status">
                            <span id="server-status-text">未运行</span>
                            <span class="status-indicator" id="server-status-indicator"></span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <span>服务器端口</span>
                        <input type="number" class="setting-input" id="pwa-port" value="3000" min="1024" max="65535">
                    </div>
                    <div class="setting-item">
                        <span>服务器地址</span>
                        <a href="#" id="pwa-server-url" target="_blank" style="color: var(--primary-color);">-</a>
                    </div>
                    <div class="server-controls">
                        <button class="menu-btn" id="btn-pwa-start">
                            <i class="fas fa-play"></i>
                            <span>启动服务器</span>
                        </button>
                        <button class="menu-btn danger" id="btn-pwa-stop">
                            <i class="fas fa-stop"></i>
                            <span>停止服务器</span>
                        </button>
                        <button class="menu-btn" id="btn-pwa-open">
                            <i class="fas fa-external-link-alt"></i>
                            <span>在浏览器中打开</span>
                        </button>
                    </div>
                    <div class="setting-hint">
                        <i class="fas fa-info-circle"></i>
                        <span>启动 PWA 服务器后,可在浏览器中访问应用,支持离线使用</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3><i class="fas fa-keyboard"></i> 快捷键</h3>
                    <div class="hotkey-list">
                        <div class="hotkey-item"><span>选择参数</span><kbd>W/A/S/D</kbd></div>
                        <div class="hotkey-item"><span>确认操作</span><kbd>Space</kbd></div>
                        <div class="hotkey-item"><span>使用卡牌</span><kbd>1-4</kbd></div>
                        <div class="hotkey-item"><span>信息面板</span><kbd>Tab</kbd></div>
                        <div class="hotkey-item"><span>暂停/菜单</span><kbd>Esc</kbd></div>
                        <div class="hotkey-item"><span>重置操作</span><kbd>R</kbd></div>
                        <div class="hotkey-item"><span>全屏切换</span><kbd>F</kbd></div>
                        <div class="hotkey-item"><span>打开终端</span><kbd>T</kbd></div>
                    </div>
                </div>
                <button class="menu-btn danger" id="btn-reset-progress">
                    <i class="fas fa-trash"></i>
                    <span>重置游戏进度</span>
                </button>

                <div class="setting-group" id="about-card">
                    <h3><i class="fas fa-circle-info"></i> 关于</h3>
                    <div class="setting-item" style="align-items:flex-start;">
                        <div id="about-info" style="color: var(--text-secondary); line-height: 1.7;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 全局特效层 -->
    <div id="effects-layer"></div>
    
    <!-- 终端界面 -->
    <div id="terminal-overlay" class="terminal-overlay hidden">
        <div class="terminal-container">
            <div class="terminal-header">
                <div class="terminal-title">
                    <i class="fas fa-terminal"></i>
                    <span>CCBalance Terminal</span>
                </div>
                <button class="terminal-close" id="btn-terminal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="terminal-output" id="terminal-output"></div>
            <div class="terminal-input-line">
                <span class="terminal-prompt">$</span>
                <input type="text" class="terminal-input" id="terminal-input" autocomplete="off" spellcheck="false">
            </div>
            <div class="terminal-suggestions" id="terminal-suggestions"></div>
        </div>
    </div>
    
    <!-- 提示信息 -->
    <div id="toast-container"></div>

    <!-- 脚本加载 -->
    <script src="src/js/utils.js"></script>
    <script src="src/js/storage-manager.js"></script>
    <script src="src/js/audio-manager.js"></script>
    <script src="src/js/particle-system.js"></script>
    <script src="src/js/animation-manager.js"></script>
    <script src="src/js/chemistry-engine.js"></script>
    <script src="src/js/levels.js"></script>
    <script src="src/js/workshop-manager.js"></script>
    <script src="src/js/ai-system.js"></script>
    <script src="src/js/card-system.js"></script>
    <script src="src/js/game-actions.js"></script>
    <script src="src/js/terminal.js"></script>
    <script src="src/js/ui-manager.js"></script>
    <script src="src/js/keyboard-handler.js"></script>
    <script src="src/js/chart-renderer.js"></script>
    <script src="src/js/game.js"></script>
    <script src="src/js/app.js"></script>
</body>
</html>
